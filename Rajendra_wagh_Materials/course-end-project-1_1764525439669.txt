PROJECT: InfraPro â€” Terraform + Ansible Integration
ðŸŽ¯ Goal

Royal Hotel wants to automatically provision a developer VM on AWS using Terraform.
Once VM is created, Terraform should trigger Ansible to configure it.

ðŸ§± FINAL PROJECT ARCHITECTURE
Terraform  â†’  Provisions AWS EC2 VM
      â†“
Creates:
  - VPC 
  - Subnets
  - Route Table
  - Internet Gateway
  - Security Group
  - Key Pair
  - EC2 (Developer VM)
      â†“
After VM is created:
      Terraform invokes â†’ ansible-playbook
                             â†“
                     Configures Developer VM


Optional: Jenkins job executes entire pipeline.

ðŸ“‚ FULL PROJECT STRUCTURE (Recommended)
InfraPro/
â”‚
â”œâ”€â”€ terraform/
â”‚   â”œâ”€â”€ main.tf
â”‚   â”œâ”€â”€ variables.tf
â”‚   â”œâ”€â”€ outputs.tf
â”‚   â””â”€â”€ provider.tf
â”‚
â””â”€â”€ ansible/
    â”œâ”€â”€ inventory
    â””â”€â”€ playbook.yml

ðŸŸ© 1. Terraform Provider (provider.tf)
terraform {
  required_providers {
    aws = {
      source = "hashicorp/aws"
      version = "~> 6.0"
    }
  }
}

provider "aws" {
  region = "us-east-1"
}

ðŸŸ© 2. Generate SSH Key Pair (Task 1)
ssh-keygen -t rsa -b 4096 -f mykey


Creates:

mykey (private key)

mykey.pub (public key)

ðŸŸ© 3. Terraform Key Pair Resource
resource "aws_key_pair" "dev_key" {
  key_name   = "dev-key"
  public_key = file("${path.module}/mykey.pub")
}

ðŸŸ© 4. VPC + Networking (Task 4)
resource "aws_vpc" "main" {
  cidr_block = "10.10.0.0/16"
}

resource "aws_subnet" "public" {
  vpc_id            = aws_vpc.main.id
  cidr_block        = "10.10.1.0/24"
  map_public_ip_on_launch = true
}

resource "aws_internet_gateway" "igw" {
  vpc_id = aws_vpc.main.id
}

resource "aws_route_table" "rt" {
  vpc_id = aws_vpc.main.id

  route {
    cidr_block = "0.0.0.0/0"
    gateway_id = aws_internet_gateway.igw.id
  }
}

resource "aws_route_table_association" "a" {
  subnet_id      = aws_subnet.public.id
  route_table_id = aws_route_table.rt.id
}

ðŸŸ© 5. Security Group
resource "aws_security_group" "dev_sg" {
  vpc_id = aws_vpc.main.id

  ingress {
    from_port   = 22
    to_port     = 22
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"]
  }

  egress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1"
    cidr_blocks = ["0.0.0.0/0"]
  }
}

ðŸŸ© 6. Launch EC2 Developer VM (Task 3)
resource "aws_instance" "dev_vm" {
  ami           = "ami-0c02fb55956c7d316" # Amazon Linux 2
  instance_type = "t2.micro"
  key_name      = aws_key_pair.dev_key.key_name
  subnet_id     = aws_subnet.public.id
  vpc_security_group_ids = [aws_security_group.dev_sg.id]

  tags = {
    Name = "developer-vm"
  }
}

ðŸŸ© 7. Output VM IP for Ansible Inventory
output "public_ip" {
  value = aws_instance.dev_vm.public_ip
}

ðŸŸ© 8. Terraform Executes Ansible After VM Creation
resource "null_resource" "configure_vm" {
  depends_on = [aws_instance.dev_vm]

  provisioner "local-exec" {
    command = <<EOT
      ANSIBLE_HOST_KEY_CHECKING=False ansible-playbook \
      -i ${aws_instance.dev_vm.public_ip}, \
      --private-key ${path.module}/mykey \
      ../ansible/playbook.yml
    EOT
  }
}


This runs Ansible automatically after EC2 is ready.

ðŸŸ¦ ANSIBLE PART (Task 5)
ðŸ“Œ ansible/inventory (dynamic inventory not needed)

NO content required because Terraform injects IP automatically.
(But you can add [dev] group if needed)

ðŸ“Œ ansible/playbook.yml
---
- name: Configure Developer VM
  hosts: all
  become: yes

  tasks:
    - name: Install git
      yum:
        name: git
        state: present

    - name: Install docker
      yum:
        name: docker
        state: present

    - name: Start docker
      service:
        name: docker
        state: started
        enabled: yes

    - name: Create developer directory
      file:
        path: /home/ec2-user/devtools
        state: directory

ðŸŸ¦ Execution Steps (Task 6)

Inside terraform/ folder:

terraform init
terraform apply -auto-approve


Terraform will:

Create VPC + networking

Create SSH key pair

Launch developer VM

Trigger Ansible automatically

Configure the VM with git, docker and dev tools

ðŸŸ© Optional â€” Jenkins Job

Pipeline:

Stage 1 â†’ Git Pull Project
Stage 2 â†’ terraform init
Stage 3 â†’ terraform apply
Stage 4 â†’ Ansible executes automatically
Stage 5 â†’ Notify Success

ðŸŽ‰ DONE â€” Complete Project Delivered

If you want, I can also provide:

âœ… Architecture diagram
âœ… Jenkinsfile (Pipeline as Code)
âœ… README.md for submission
âœ… ZIP-ready folder structure